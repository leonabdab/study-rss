"use strict";var DbSchema=require("../schema"),parseRss=require("../../app-modules/parse-rss"),formatToHTML=require("../../app-modules/format-email"),getDataFromSchema=function(){return DbSchema.find().select({email:0,__v:0})},get=function(e,t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=t,e.next=4,regeneratorRuntime.awrap(getDataFromSchema());case 4:return e.t1=e.sent,e.abrupt("return",e.t0.json.call(e.t0,e.t1));case 8:e.prev=8,e.t2=e.catch(0),console.error("RssGet: ",e.t2.message);case 11:case"end":return e.stop()}},null,null,[[0,8]])},getRssEmailContent=function(e,t){var r,n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(getDataFromSchema());case 3:return r=e.sent,e.next=6,regeneratorRuntime.awrap(Promise.all(parseRss(r)));case 6:n=e.sent,s="",n&&(n.forEach(function(e){s+=formatToHTML(e.title,e.content)}),t.set("Content-Type","text/html"),t.status(200).send(s)),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0),console.error("RssGet: ",e.t0.message);case 15:case"end":return e.stop()}},null,null,[[0,11]])},put=function(t,r){var n,s,a,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.id,e.next=4,regeneratorRuntime.awrap(t.body);case 4:if(s=e.sent,a=s.rss,n){e.next=8;break}return e.abrupt("return",r.status(404).send("Error: id: ".concat(n," not found")));case 8:if(a)return e.next=11,regeneratorRuntime.awrap(DbSchema.findByIdAndUpdate(n,{$set:{rss:a}},{new:!0}));e.next=13;break;case 11:o=e.sent,r.json(o);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("RssPut: ",e.t0.message);case 18:case"end":return e.stop()}},null,null,[[0,15]])},post=function(t,r,n){var s,a,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body.rss)return a=new DbSchema({rss:s}),e.next=6,regeneratorRuntime.awrap(a.save());e.next=8;break;case 6:o=e.sent,r.json(o);case 8:n(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("RssPost: ",e.t0.message);case 14:case"end":return e.stop()}},null,null,[[0,11]])},deleteRss=function(t,r){var n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=t.params.id){e.next=4;break}return e.abrupt("return",r.status(404).send("Error: id: ".concat(n," not found")));case 4:return e.next=6,regeneratorRuntime.awrap(DbSchema.findByIdAndRemove(n));case 6:s=e.sent,r.json(s),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("RssDelete: ",e.t0.message);case 13:case"end":return e.stop()}},null,null,[[0,10]])};module.exports={get:get,put:put,post:post,deleteRss:deleteRss,getRssEmailContent:getRssEmailContent};